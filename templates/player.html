<!DOCTYPE html>
<html>
<head>
    <title>Player</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; background: #333; color: white; margin: 0; padding: 20px; }
        
        /* LOGIN SCREEN */
        #login { max-width: 400px; margin: 0 auto; }
        input[type="text"] { padding: 15px; font-size: 1.2em; width: 80%; margin-bottom: 20px; border-radius: 5px; border: none;}
        
        /* AVATAR GRID */
        .avatar-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-bottom: 20px; }
        .avatar-opt { 
            width: 100%; aspect-ratio: 1; background: #555; border-radius: 50%; cursor: pointer; 
            border: 3px solid transparent; overflow: hidden;
        }
        .avatar-opt img { width: 100%; height: 100%; object-fit: cover; }
        .avatar-opt.selected { border-color: #33FF57; transform: scale(1.1); box-shadow: 0 0 10px #33FF57; }

        button.join-btn { padding: 15px 30px; font-size: 1.5em; background: #26890c; color: white; border: none; border-radius: 5px; cursor: pointer; width: 100%; }

        /* GAME PAD */
        #game-pad { display: none; grid-template-columns: 1fr 1fr; height: 80vh; gap: 10px; margin-top: 20px;}
        button.btn { border: none; font-size: 2em; color: white; width: 100%; height: 100%; cursor: pointer; border-radius: 10px;}
        .A { background: #e21b3c; } .B { background: #1368ce; }
        .C { background: #d89e00; } .D { background: #26890c; }
        
        #waiting-msg { display: none; margin-top: 50px; font-size: 1.5em; }
    </style>
</head>
<body>
    <div id="login">
        <h2>Join Game</h2>
        <input type="text" id="username" placeholder="Nickname">
        
        <h3>Choose Avatar</h3>
        <div class="avatar-grid" id="avatar-grid">
            </div>

        <button class="join-btn" onclick="joinGame()">Join</button>
    </div>

    <div id="waiting-msg">You are in! Look at the big screen.</div>

    <div id="game-pad">
        <button class="btn A" onclick="submit('A')">A</button>
        <button class="btn B" onclick="submit('B')">B</button>
        <button class="btn C" onclick="submit('C')">C</button>
        <button class="btn D" onclick="submit('D')">D</button>
    </div>

    <script>
        const socket = io();
        let selectedAvatar = 1;

        // Generate Avatar Grid
        const grid = document.getElementById('avatar-grid');
        for(let i=1; i<=10; i++) {
            let div = document.createElement('div');
            div.className = 'avatar-opt';
            if(i === 1) div.classList.add('selected');
            div.innerHTML = `<img src="/static/avatars/${i}.png">`;
            div.onclick = () => selectAvatar(i, div);
            grid.appendChild(div);
        }

        function selectAvatar(id, el) {
            selectedAvatar = id;
            document.querySelectorAll('.avatar-opt').forEach(d => d.classList.remove('selected'));
            el.classList.add('selected');
        }

        function joinGame() {
            const name = document.getElementById('username').value;
            if(name) {
                // SEND AVATAR ID WITH NAME
                socket.emit('join_game', {name: name, avatar: selectedAvatar});
                
                document.getElementById('login').style.display = 'none';
                document.getElementById('waiting-msg').style.display = 'block';
            }
        }

        socket.on('new_question', (q) => {
            document.getElementById('waiting-msg').style.display = 'none';
            document.getElementById('game-pad').style.display = 'grid';
        });

        socket.on('update_player_list', (players) => {
             // Optional: Show score on phone?
        });

        function submit(answer) {
            socket.emit('submit_answer', {answer: answer});
            document.getElementById('game-pad').style.display = 'none';
            document.getElementById('waiting-msg').innerText = "Answer Sent!";
            document.getElementById('waiting-msg').style.display = 'block';
        }
    </script>
</body>
</html>
